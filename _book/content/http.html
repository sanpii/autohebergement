<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Serveur web | S’auto-héberger</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../content/ftp.html" />
    
    
    <link rel="prev" href="../content/ssh.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-richquotes/plugin.css">
        
    
    

        
    <div class="book" data-level="6" data-basepath=".." data-revision="Thu Jul 09 2015 19:54:03 GMT+0200 (CEST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="content/introduction.html">
            
            <span><b>1.</b> Pourquoi s’auto-héberger</span>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="content/materiel.html">
            
                
                    <a href="../content/materiel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Le matériel
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="content/installation.html">
            
                
                    <a href="../content/installation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Installation du système
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="content/reboot.html">
            
                
                    <a href="../content/reboot.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Premier redémarrage
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="content/ssh.html">
            
                
                    <a href="../content/ssh.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Accès à distance
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="6" data-path="content/http.html">
            
                
                    <a href="../content/http.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Serveur web
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="content/ftp.html">
            
                
                    <a href="../content/ftp.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Transfert de fichiers
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="content/mail.html">
            
            <span><b>8.</b> Mail</span>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="content/dns.html">
            
            <span><b>9.</b> Nom de domaine</span>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="content/seeks.html">
            
            <span><b>10.</b> Moteur de recherche</span>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="content/jabber.html">
            
            <span><b>11.</b> Messagerie instantanée</span>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="content/cups.html">
            
            <span><b>12.</b> Impression</span>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="content/io.html">
            
            <span><b>13.</b> Internet des objets</span>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="content/supervision.html">
            
            <span><b>14.</b> Supervision</span>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="content/securite.html">
            
            <span><b>15.</b> Sécurité</span>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="content/ssl.html">
            
            <span><b>16.</b> SSL</span>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="content/juridique.html">
            
            <span><b>17.</b> Quelques notions juridiques</span>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="content/epilogue.html">
            
            <span><b>18.</b> Épilogue</span>
            
            
        </li>
    
        <li class="chapter " data-level="19" >
            
            <span><b>19.</b> Annexes</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="19.1" data-path="content/annexes/commandes.html">
            
            <span><b>19.1.</b> Mémo des commandes utiles sous GNU/Linux</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.2" data-path="content/annexes/package.html">
            
            <span><b>19.2.</b> Gestion des logiciels</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.3" data-path="content/annexes/mdp.html">
            
            <span><b>19.3.</b> Comment avoir un bon mot de passe</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.4" >
            
            <span><b>19.4.</b> Exemple d’applications web</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="19.4.1" data-path="content/annexes/drupal.html">
            
            <span><b>19.4.1.</b> Drupal</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.4.2" data-path="content/annexes/owncloud.html">
            
            <span><b>19.4.2.</b> Owncloud</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.4.3" data-path="content/annexes/wordpress.html">
            
            <span><b>19.4.3.</b> Wordpress</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="19.5" data-path="content/annexes/cron.html">
            
            <span><b>19.5.</b> Lancer des commandes périodiquement</span>
            
            
        </li>
    
        <li class="chapter " data-level="19.6" data-path="content/annexes/lcen.html">
            
            <span><b>19.6.</b> Loi pour la confiance dans l&#39;économie numérique</span>
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >S’auto-héberger</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="le-serveur-web">Le serveur web</h1>
<p>Un serveur web permet de d&#xE9;livrer des pages que vous pouvez consulter via
votre navigateur. C&apos;est certainement la part la plus visible d&apos;internet.</p>
<p>Il en existe plusieurs, le plus connu est <a href="http://httpd.apache.org/" target="_blank">apache</a>
mais il peux demander beaucoup de ressources pour &#xEA;tre utilis&#xE9; sachant que nous
n&apos;utiliserons pas la moiti&#xE9; de ses fonctionnalit&#xE9;s. J&apos;ai opt&#xE9; pour
<a href="http://nginx.org/" target="_blank">nginx</a> mais si vous &#xEA;tes curieux, il en existe d&apos;autres :</p>
<ul>
<li><a href="http://www.lighttpd.net/" target="_blank">lighttpd</a> ;</li>
<li><a href="http://www.cherokee-project.com/" target="_blank">Cherokee</a>.</li>
</ul>
<p>M&#xEA;me si un serveur web est suffisant pour publier quelques pages en HTML, si
vous souhaitez par la suite installer des logiciels tel qu&apos;un blog ou un forum
vous aurez &#xE9;galement besoin d&apos;une <a href="http://fr.wikipedia.org/wiki/Base_de_donn&#xE9;es" target="_blank">base de donn&#xE9;es</a>
et d&apos;un langage de programmation tel que <a href="http://fr.wikipedia.org/wiki/PHP" target="_blank">PHP</a>.</p>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-4x fa-edit"></strong>
<p> J&#x2019;ai choisi PHP car c&#x2019;est celui que je maitrise le mieux et sa
popularit&#xE9; vous assure de trouver un grand nombre de logiciels.</p>
</blockquote>
<p>Les trois &#xE9;tant tr&#xE8;s souvent install&#xE9;s en m&#xEA;me temps, nous allons en faire de
m&#xEA;me afin que vous disposiez, la fin de ce chapitre, d&apos;un serveur web digne de
ce nom.</p>
<h2 id="nginx">Nginx </h2>
<p>Commen&#xE7;ons par installer notre serveur HTTP :</p>
<pre><code># apt-get install nginx
</code></pre><p>Au niveau de la configuration de notre serveur, vous pouvez commencer par ouvrir
le fichier <code>/etc/nginx/nginx.conf</code> qui contient la configuration globale du
serveur. Dans le cadre d&apos;une utilisation normale, il n&apos;est pas utile de modifier
ce fichier.</p>
<p>Les parties int&#xE9;ressante de la configuration de nginx se trouve dans les
r&#xE9;pertoires <code>/etc/nginx/conf.d</code> pour les modules qui impacts tous les sites
(typiquement <a href="tls.md">TLS</a>) et <code>/etc/nginx/sites-available/</code> pour les
configuration li&#xE9;s &#xE0; chaque site. Nous y reviendrons une fois tous les autres
composants install&#xE9;s.</p>
<p><img src="images/nginx.png" alt=""></p>
<h2 id="postgresql">Postgresql </h2>
<p>Concernant la base de donn&#xE9;es, je vous propose un peu d&#x2019;originalit&#xE9;. Normalement
j&#x2019;aurais du vous pr&#xE9;senter MySQL, sauf que son installation est extr&#xEA;mement
simple mais suretout je pr&#xE9;f&#xE8;re vous faire d&#xE9;couvrir une base de donn&#xE9;es Libre
et communautaire qui vous fera retrouver foi dans le SQL<sup><a href="#fn_1" id="reffn_1">1</a></sup>.</p>
<p>L&apos;installation se passe de commentaire :</p>
<pre><code># apt-get install postgresql postgresql-client
</code></pre><p>Si l&#x2019;installation n&#x2019;a rien de compliqu&#xE9;e, sa configuration a pour r&#xE9;putation de
l&#x2019;&#xEA;tre. Dans un premier temps je me suis content&#xE9; de la configuration par d&#xE9;faut
sans que cela me pose de probl&#xE8;me (on reste sur des applications de tailles
modestes), mais apr&#xE8;s avoir d&#xE9;couvert l&#x2019;outils
<a href="http://pgtune.leopard.in.ua/" target="_blank">pgtune</a> il n&#x2019;y a pas de raison de se priver de
quelques optimisations :</p>
<p><img src="images/pgtune.png" alt="" title="PgTune"></p>
<p>Avec PostgreSQL c&#x2019;est l&#x2019;utilisateur <code>postgres</code> qui poss&#xE8;de tous les droits. Afin
de nous simplifier la vie, nous pouvons cr&#xE9;er un utilisateur pour PostgreSQL
avec le m&#xEA;me nom que notre utilisateur syst&#xE8;me :</p>
<pre><code>$ sudo -u postgres createuser --interactive
Enter name of role to add: sanpi
Shall the new role be a superuser? (y/n) y
</code></pre><p>Nous pouvons maintenant cr&#xE9;er notre premi&#xE8;re base de donn&#xE9;es :</p>
<pre><code>$ createdb sanpi
</code></pre><p>Ainsi nous pouvons nous connecter directement :</p>
<pre><code>$ psql

psql (9.4.3)
Type &quot;help&quot; for help.

sanpi=# \?
&#x2026;
</code></pre><h2 id="php">PHP </h2>
<p>Le dernier &#xE9;l&#xE9;ment, le langage de script PHP. Il s&apos;agit de la phase de
l&apos;installation la plus compliqu&#xE9;e (&#xE7;a reste relatif&#x2026;) puisqu&apos;il va falloir
faire le lien entre le serveur HTTP, PostreSQL et PHP.</p>
<p>Commen&#xE7;ons par installer l&apos;interpr&#xE9;teur, mais nous avons &#xE9;galement besoin du
module pour PostreSQL :</p>
<pre><code># apt-get install php5-fpm php5-pgsql
</code></pre><p>Pour la configuration, vous pouver lire le fichier <code>/etc/php5/fpm/php.ini</code> mais
il ne faut pas le modifier directement<sup><a href="#fn_2" id="reffn_2">2</a></sup>. Cr&#xE9;ez simplement un fichier
<code>/etc/php5/mods-available/custom.ini</code> qui contient vos modifications :</p>
<pre><code class="lang-ini">date.timezone = Europe/Paris
opcache.enable = 1
opcache.save_comments = 1
opcache.load_comments = 1
</code></pre>
<p>Et activer cette configuration pour FPM :</p>
<pre><code># ln -s /etc/php5/mods-available/custom.ini /etc/php5/fpm/conf.d/99-custom.ini
</code></pre><p><a href="http://php-fpm.org/" target="_blank">FPM</a> est l&#x2019;une des mani&#xE8;res d&#x2019;int&#xE9;ragir avec PHP, vous
avez peut &#xEA;tre d&#xE9;j&#xE0; entendu parler de CGI ? Cette SAPI se veux simple et
robuste. En tant d&#x2019;utilisateur, je retiens surto&#xFB;t la possibilit&#xE9; de faire
tourner PHP avec un utilisateur arbitraire ce qui vous nous &#xE9;viter beaucoup de
soucis de gestion de droits.</p>
<pre><code># cp /etc/php5/fpm/pool.d/{www,sanpi}.conf
</code></pre><p>Ensuite &#xE9;ditez le fichier pour modifier le nom de la r&#xE9;serve, l&#x2019;utilisateur et
le nom du fichier d&#x2019;&#xE9;coute :</p>
<pre><code># sed -i &apos;s/\[www\]/[sanpi]/g&apos; /etc/php5/fpm/pool.d/sanpi.conf
# sed -i &apos;s/www-data/sanpi/g&apos; /etc/php5/fpm/pool.d/sanpi.conf
# sed -i &apos;s/php5-fpm\.sock/php5-sanpi.sock/g&apos; /etc/php5/fpm/pool.d/sanpi.conf
</code></pre><p>Et red&#xE9;marrez le service :</p>
<pre><code># systemctl restart php5-fpm.service
</code></pre><h2 id="premier-site-dynamique">Premier site dynamique</h2>
<p>&#xC0; ce stade l&#xE0;, si vous essayez d&apos;afficher une page &#xE9;crite en PHP, le serveur
vous proposera de t&#xE9;l&#xE9;charger le fichier, ce n&#x2019;est pas vraiment le comportement
attendu&#x2026; Tout simplement parce que nous ne l&apos;avons pas configurer pour qu&apos;il
fasse appel &#xE0; PHP.</p>
<p>On commence par supprimer le site par d&#xE9;faut :</p>
<pre><code># rm /etc/nginx/sites-enabled/default
</code></pre><p>Cr&#xE9;ons un nouvel h&#xF4;te virtuel (<em>virtual host</em>) :</p>
<pre><code># cat &gt; /etc/nginx/sites-available/php-test &lt;&lt;EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /home/sanpi/public_html/test;
    index index.php;

    server_name _;

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php5-sanpi.sock;
    }
}
EOF
</code></pre><p>Un script PHP minimal pour v&#xE9;rifier que cela fonctionne :</p>
<pre><code>$ mkdir -p /home/sanpi/public_html/test
$ cat &gt; /home/sanpi/public_html/test/index.php &lt;&lt;EOF
&lt;?php

phpinfo();
EOF
</code></pre><p>Et enfin rechargeons nginx pour qu&#x2019;il prenne en compte la nouvelle
configuration :</p>
<pre><code># ln -s /etc/nginx/sites-{available,enabled}/php-test
# systemctl reload nginx.service
</code></pre><p><img src="images/php.png" alt=""></p>
<h2 id="logiciels">Quelques logiciels </h2>
<p>Votre serveur est maintenant fonctionnel, il ne vous reste plus qu&apos;&#xE0; trouver
des applications pour l&apos;occuper. Comme je le pr&#xE9;cisais en introduction, le choix
de PHP n&apos;est pas innocent c&apos;est le plus populaire dans ce domaine, vous
trouverez donc des milliers d&apos;applications libres pour cr&#xE9;er un blog, un forum,
h&#xE9;berger des images, &#x2026; In&#xE9;vitables dans le lot, il existe des applications en
cours de d&#xE9;veloppement, des applications bugu&#xE9;es, bref il faut g&#xE9;n&#xE9;ralement en
tester quelques unes avant de trouver celles qui vous convient.</p>
<p>Voici donc une liste, non exhaustive, d&apos;applications pour fournir les principaux
services :</p>
<ul>
<li><a href="http://drupalfr.org/" target="_blank">Drupal</a> : au d&#xE9;part je m&apos;en servais pour l&apos;ensemble de
mes sites, il est tr&#xE8;s polyvalent ;</li>
<li><a href="http://www.wordpress-fr.net/" target="_blank">WordPress</a> : beaucoup plus simple pour mettre
en place un simple blog (puisqu&apos;il est justement fait pour&#x2026;) ;</li>
<li><a href="http://piwik.org/" target="_blank">Piwik</a> : pour suivre l&apos;audiance de vos sites ;</li>
<li><a href="http://selfoss.aditu.de/" target="_blank">Selfoss</a> : un agr&#xE9;gateur de flux RSS,</li>
<li><a href="http://roundcube.net/" target="_blank">Roundcube</a> : pour consulter mes mails en dehors de
chez moi ;</li>
<li><a href="http://fr.piwigo.org/" target="_blank">Piwigo</a> : pour partager mes photo,</li>
<li><a href="http://www.yourls.org/" target="_blank">Yourls</a> : pour raccourcir les URL ;</li>
<li><a href="http://www.dokuwiki.org/" target="_blank">DokuWiki</a> : pour cr&#xE9;er un wiki ;</li>
<li><a href="http://chevereto.com/" target="_blank">Chevereto</a> : pour h&#xE9;bergement rapidement des images et
ensuite les poster sur un forum, par exemple ;</li>
<li><a href="http://sebsauvage.net/wiki/doku.php?id=php:zerobin" target="_blank">ZeroBin</a> : un
pastebin-like pour partager rapidement des morceaux de code ;</li>
<li><a href="https://owncloud.com/" target="_blank">Owncloud</a> : synchronisation des fichiers, contacts et
agenda.</li>
</ul>
<p>Vous pouvez vous reporter aux annexes pour un <a href="annexes/owncloud.md">exemple
d&#x2019;installation</a>.</p>
<p><sup><a href="#fn_1" id="reffn_1">1</a></sup> Parce que vous n&#x2019;utilisez plus Windows 3.1, pourquoi continuer &#xE0; se limiter
au SQL-92 : <a href="http://use-the-index-luke.com/blog/2015-02/modern-sql" target="_blank">http://use-the-index-luke.com/blog/2015-02/modern-sql</a></p>
<p><sup><a href="#fn_2" id="reffn_2">2</a></sup> &#xC0; la prochaine mise &#xE0; jour de PHP, vous allez devoir faire la liste des
modifications pour mettre &#xE0; jour la configuration.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../content/ssh.html" class="navigation navigation-prev " aria-label="Previous page: Accès à distance"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../content/ftp.html" class="navigation navigation-next " aria-label="Next page: Transfert de fichiers"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
